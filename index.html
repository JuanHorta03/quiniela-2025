document.getElementById("quinielaForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const nombre = document.getElementById("nombre").value.trim();
  if (!nombre) {
    alert("Por favor, escribe tu nombre.");
    return;
  }

  let mensaje = `*Mi Quiniela - ${nombre}*:%0A`;
  let todosSeleccionados = true;
  let respuestas = [];

  partidos.forEach((partido, index) => {
    const seleccion = partido.querySelector(".btn-opcion.seleccionado");
    if (seleccion) {
      const valor = seleccion.getAttribute("data-valor");
      let letra = valor === "Empate" ? "E" : (indexar(valor, partido) ? "L" : "V");
      respuestas.push(letra);
      mensaje += `${index + 1}. ${letra}%0A`;
    } else {
      todosSeleccionados = false;
    }
  });

  if (!todosSeleccionados) {
    alert("Debes seleccionar una opción en todos los partidos.");
    return;
  }

  // Enviar los datos al Google Sheets usando el Webhook
  const webhookURL = "https://script.google.com/macros/s/AKfycbXXXXXXXXXXX/exec"; // Reemplaza esta URL con la URL de tu Webhook

  fetch(webhookURL, {
    method: "POST",
    body: JSON.stringify({
      nombre: nombre,
      respuestas: respuestas
    }),
    headers: {
      "Content-Type": "application/json"
    }
  }).then(() => {
    // Una vez que los datos se guarden en Google Sheets, abrir WhatsApp
    const telefono = "524775670219";  // Reemplaza con el número de teléfono correcto
    const url = `https://wa.me/${telefono}?text=${mensaje}`;
    window.open(url, "_blank");
  }).catch(() => {
    alert("Error al guardar los resultados.");
  });
});

function indexar(valor, partido) {
  const local = partido.querySelector(".nombre-equipo.local").textContent.trim();
  return valor === local;
}
